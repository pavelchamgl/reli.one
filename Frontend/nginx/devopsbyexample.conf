upstream backend {
    server backend:8081;
}

server {
  listen 3000;
  listen [::]:3000 ipv6only=on;
  server_name localhost;
  listen 443 ssl;
  ssl_certificate     www.solopharma.shop.crt;
  ssl_certificate_key www.solopharma.shop.key;
  ssl_protocols       TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
  ssl_ciphers         HIGH:!aNULL:!MD5;


  access_log  /var/log/nginx/httpstatus.access.log;
  error_log  /var/log/nginx/httpstatus.error.log;


  location /admin {
        proxy_pass http://backend;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
        proxy_redirect off;
  }

  location /api {
        proxy_pass http://backend;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
        proxy_redirect off;
  }


  location /static/admin/ {
        alias /app/static/admin/;
  }

  location /static/rest_framework/ {
        alias /app/static/rest_framework/;
  }

  location /media/ {
        alias /app/media/;
  }

  location / {
      root /data/www;
      index index.html;
      try_files $uri $uri/ /;
   }
}
