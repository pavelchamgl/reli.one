{% extends "emails/base_email.html" %}

{% block content %}
  <table width="100%" cellpadding="0" cellspacing="0" style="font-family:Arial, sans-serif; font-size:14px; color:#333333; border-collapse:collapse; width:100%;">
    <tr>
      <td style="padding-bottom:10px;">
        <h2 style="margin:0; font-size:20px;">NEW ORDER</h2>
        <p style="margin:10px 0;">
          <strong>Client:</strong> {{ customer.first_name }} {{ customer.last_name }}<br>
          <strong>Email:</strong> {{ customer.email }}<br>
          <strong>Phone:</strong> {{ customer.phone }}
        </p>
        <p><strong>Order date:</strong> {{ order_date }}</p>
      </td>
    </tr>

    {% for group in groups %}
      <tr>
        <td style="padding:20px 0 10px 0; border-top:2px solid #FFD247;">
          <h3 style="margin:0; font-size:16px;">Order No.: {{ group.order_number }}</h3>
          <p style="margin:5px 0;">Delivery Method: {{ group.delivery_type }} {{ group.courier_service }}</p>

          {% if group.delivery_address %}
            <p style="margin:5px 0;"><strong>Delivery address:</strong> {{ group.delivery_address }}</p>
          {% elif group.pickup_point_info %}
            <p style="margin:5px 0;"><strong>Pickup Point:</strong> {{ group.pickup_point_info }}</p>
          {% endif %}

          {% if group.sellers %}
            <p style="margin:5px 0;"><strong>Seller:</strong> {{ group.sellers|join:", " }}</p>
          {% endif %}
        </td>
      </tr>

      <!-- Таблица товаров -->
      <tr>
        <td>
          <table cellpadding="0" cellspacing="0" width="100%" style="border-collapse:collapse; margin-top:10px;">
            <thead>
              <tr>
                <th style="background-color:#FFD247; color:#000000; padding:10px; border:1px solid #dddddd; text-align:left;">Item</th>
                <th style="background-color:#FFD247; color:#000000; padding:10px; border:1px solid #dddddd; text-align:left;">Quantity</th>
                <th style="background-color:#FFD247; color:#000000; padding:10px; border:1px solid #dddddd; text-align:left;">Price per unit</th>
                <th style="background-color:#FFD247; color:#000000; padding:10px; border:1px solid #dddddd; text-align:left;">Total Price</th>
              </tr>
            </thead>
            <tbody>
              {% for p in group.products %}
                <tr>
                  <td style="padding:10px; border:1px solid #dddddd;">
                    <div class="mobile-label" style="display:none; font-weight:bold;">Item</div>
                    <div>{{ p.product_name }}</div>
                  </td>
                  <td style="padding:10px; border:1px solid #dddddd;">
                    <div class="mobile-label" style="display:none; font-weight:bold;">Quantity</div>
                    <div>{{ p.quantity }}</div>
                  </td>
                  <td style="padding:10px; border:1px solid #dddddd;">
                    <div class="mobile-label" style="display:none; font-weight:bold;">Price per unit</div>
                    <div>{{ p.unit_price }} €</div>
                  </td>
                  <td style="padding:10px; border:1px solid #dddddd;">
                    <div class="mobile-label" style="display:none; font-weight:bold;">Total Price</div>
                    <div>{{ p.total_price }} €</div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

          <p style="margin-top:10px;">Delivery price: {{ group.delivery_cost }} €</p>
          <p><strong>Total for this order:</strong> {{ group.group_total }} €</p>
        </td>
      </tr>

      {% if group.parcels %}
        <tr>
          <td style="padding:20px 0;">
            <h3 style="margin:0 0 10px 0; font-size:16px;">SHIPMENT DETAILS</h3>
            {% for parcel in group.parcels %}
              <p style="margin:5px 0;"><strong>Tracking Number:</strong> {{ parcel.tracking_number }}</p>
              <ul style="margin:0 0 10px 20px; padding:0;">
                {% for item in parcel.items %}
                  <li style="margin:2px 0;">{{ item.quantity }}× {{ item.product_name }} (SKU: {{ item.sku }})</li>
                {% endfor %}
              </ul>
            {% endfor %}
          </td>
        </tr>
      {% endif %}
    {% endfor %}

    <tr>
      <td style="padding-top:20px; border-top:2px solid #FFD247;">
        <p style="font-size:16px;"><strong>Total amount paid: {{ grand_total }} €</strong></p>
      </td>
    </tr>
  </table>
{% endblock %}
